(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/createOrder"],{"023b":function(e,t,n){"use strict";n.r(t);var i=n("6e03"),r=n.n(i);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=r.a},"54e4":function(e,t,n){"use strict";n.r(t);var i=n("6ff3"),r=n("023b");for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);n("6a77");var a,u=n("f0c5"),c=Object(u["a"])(r["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],a);t["default"]=c.exports},"6a77":function(e,t,n){"use strict";var i=n("c781"),r=n.n(i);r.a},"6e03":function(e,t,n){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(n("4795")),o=n("f01b"),a=u(n("9386"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t,n,i,r,o,a){try{var u=e[o](a),c=u.value}catch(s){return void n(s)}u.done?t(c):Promise.resolve(c).then(i,r)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function a(e){f(o,i,r,a,u,"next",e)}function u(e){f(o,i,r,a,u,"throw",e)}a(void 0)}))}}var l=function(){n.e("components/empty").then(function(){return resolve(n("e4d2"))}.bind(null,n)).catch(n.oe)},h=function(){n.e("components/mpvue-picker/mpvuePicker").then(function(){return resolve(n("0d13"))}.bind(null,n)).catch(n.oe)},m=function(){n.e("components/rf-image/rf-image").then(function(){return resolve(n("4e9d"))}.bind(null,n)).catch(n.oe)},g={components:{mpvuePicker:h,empty:l,rfImage:m},data:function(){return{maskState:0,desc:"",payType:1,orderDetail:{},pointExchangeType:[],loadingType:"more",pickerShippingType:[{label:"物流配送",value:1},{label:"买家自提",value:2}],currentShippingType:{},currentCompany:{},currentPickupPoint:{},cartIds:null,invoiceItem:{},addressData:{},couponItem:{},pointConfig:{},product:null,shippingMoney:0,isUsePoint:!1,isUsePointDisabled:!1,data:{},userInfo:{},use_point:0,invoiceContent:null}},computed:{amountGoods:function(){var e=0;return this.orderDetail.products&&this.orderDetail.products.forEach((function(t){e+=parseInt(t.num,10)*parseFloat(t.price)})),this.floor(e)},discountAmount:function(){var e=this.floor((100-this.couponItem.discount)/100*this.amountGoods);return 2===parseInt(this.couponItem.type,10)?e:this.couponItem.money||0},realAmount:function(){var e=this.amountGoods-this.discountAmount+parseFloat(this.shippingMoney)-(this.isUsePoint?this.maxUsePointFee:0);return(this.floor(parseFloat(this.invoiceAmount)+e)||0).toFixed(2)},invoiceAmount:function(){var e=this.amountGoods-this.discountAmount-(this.isUsePoint?this.maxUsePointFee:0);return this.invoiceItem.type?this.floor(this.orderDetail.invoice.order_invoice_tax/100*e):0},maxUsePoint:function(){return this.orderDetail.max_use_point>e.getStorageSync("userInfo").account.user_integral?e.getStorageSync("userInfo").account.user_integral:this.orderDetail.max_use_point},maxUsePointFee:function(){return this.maxUsePoint*this.pointConfig.convert_rate}},filters:{time:function(e){return(0,a.default)(1e3*e).format("YY/MM/DD HH:mm")}},onShow:function(){this.addressData&&this.addressData.realname&&this.getOrderFreightFee()},onLoad:function(e){this.initData(e)},methods:{handleInvoiceChange:function(e){this.invoiceContent=e},navTo:function(t){e.navigateTo({url:t})},closeInvoice:function(){this.invoiceItem={}},floor:function(e){return Math.floor(100*e)/100},handleIsUsePoint:function(){this.isUsePoint?(this.isUsePoint=!1,this.use_point=0):(this.isUsePoint=!0,this.use_point=this.maxUsePoint)},showSinglePicker:function(){this.$refs.shippingTypePicker.show()},showCompanyPicker:function(){this.$refs.companyTypePicker.show()},showPickupPointPicker:function(){this.$refs.pickupPointPicker.show()},onConfirm:function(e){e.value=e.value[0],this.currentShippingType=e,2==this.currentShippingType.value?parseFloat(this.realAmount)>parseFloat(this.orderDetail.pickup_point_config.pickup_point_freight)?this.shippingMoney=0:this.shippingMoney=parseFloat(this.orderDetail.pickup_point_config.pickup_point_fee)||0:(this.currentCompany=this.orderDetail.company[0],this.getOrderFreightFee())},onCompanyConfirm:function(e){var t=this;return d(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.value=e.value[0],t.currentCompany=e,!t.orderDetail.is_full_mail){n.next=5;break}return t.shippingMoney=0,n.abrupt("return");case 5:t.getOrderFreightFee();case 6:case"end":return n.stop()}}),n)})))()},onPickupPointConfirm:function(e){var t=this;return d(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.value=e.value[0],t.currentPickupPoint=e,!t.currentPickupPoint){n.next=5;break}return t.shippingMoney=parseFloat(t.orderDetail.pickup_point_config.pickup_point_fee)||0,n.abrupt("return");case 5:case"end":return n.stop()}}),n)})))()},getOrderFreightFee:function(){var e=this;return d(r.default.mark((function t(){var n;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={},e.addressData&&(n.address_id=e.addressData.id),e.currentCompany&&(n.company_id=e.currentCompany.value),t.next=5,e.$get("".concat(o.orderFreightFee),s({},n,{},e.data)).then((function(t){e.shippingMoney=t.data.shipping_money||0})).catch((function(e){i("log",e," at pages\\order\\createOrder.vue:422")}));case 5:case"end":return t.stop()}}),t)})))()},initData:function(t){var n=this;return d(r.default.mark((function i(){return r.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,JSON.parse(t.data);case 2:return n.data=i.sent,n.userInfo=e.getStorageSync("userInfo"),i.next=6,n.getOrderDetail(n.data);case 6:case"end":return i.stop()}}),i)})))()},getOrderDetail:function(e){var t=this;return d(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$get("".concat(o.orderPreview),s({},e)).then((function(e){t.orderDetail=e.data,t.pointConfig=t.orderDetail.point_config,t.addressData=t.orderDetail.address,t.currentShippingType=t.pickerShippingType[0],t.orderDetail.company.forEach((function(e){e.label=e.title,e.value=e.id})),t.currentCompany=t.orderDetail.company[0],t.pointExchangeType=[],t.orderDetail.products.forEach((function(e){t.pointExchangeType.push(e.point_exchange_type)})),1===parseInt(t.orderDetail.pickup_point_config.buyer_self_lifting,10)?(t.orderDetail.pickup_point_config.list.forEach((function(e){e.label="".concat(e.contact||"无名"," - ").concat(e.name||"未知"," - ").concat(e.address||"未知"),e.value=e.id})),t.currentPickupPoint=t.orderDetail.pickup_point_config.list[0]||{},t.shippingMoney=e.data.preview.shipping_money):t.orderDetail.pickup_point_config.list=[]})).catch((function(e){i("log",e," at pages\\order\\createOrder.vue:469")}));case 2:case"end":return n.stop()}}),n)})))()},toggleMask:function(e){var t=this,n="show"===e?10:300,i="show"===e?1:0;this.maskState=2,setTimeout((function(){t.maskState=i}),n)},numberChange:function(e){this.number=e.number},changePayType:function(e){this.payType=e},submit:function(){var t=this;return d(r.default.mark((function n(){var a;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a={},!t.addressData||!t.addressData.id){n.next=5;break}a.address_id=t.addressData.id,n.next=7;break;case 5:return t.$api.msg("请选择收货地址"),n.abrupt("return");case 7:return t.couponItem&&t.couponItem.id&&(a.coupon_id=t.couponItem.id),t.invoiceItem&&t.invoiceItem.id&&(a.invoice_id=t.invoiceItem.id,a.invoice_content=t.invoiceContent||t.orderDetail.invoice.list[0]),t.currentCompany&&t.currentCompany.value&&(a.company_id=t.currentCompany.value),t.currentPickupPoint&&t.currentPickupPoint.value&&(a.pickup_id=t.currentPickupPoint.value),t.currentShippingType&&t.currentShippingType.value&&(a.shipping_type=t.currentShippingType.value),t.use_point&&(a.use_point=t.use_point),n.next=15,t.$post("".concat(o.orderCreate),s({},a,{},t.data)).then((function(t){var n={};n.order_id=parseInt(t.data.id,10),1===parseInt(t.data.pay_status,10)?e.redirectTo({url:"/pages/money/paySuccess"}):e.redirectTo({url:"/pages/money/pay?id=".concat(t.data.id)})})).catch((function(e){i("log",e," at pages\\order\\createOrder.vue:536")}));case 15:case"end":return n.stop()}}),n)})))()},stopPrevent:function(){},selectCoupon:function(e){this.amountGoods<e.at_least?this.$api.msg("不满足优惠券使用条件~"):(this.maskState=0,this.couponItem=e)}}};t.default=g}).call(this,n("6e42")["default"],n("0de9")["default"])},"6ff3":function(e,t,n){"use strict";var i={"rf-image":function(){return n.e("components/rf-image/rf-image").then(n.bind(null,"4e9d"))}},r=function(){var e=this,t=e.$createElement,n=(e._self._c,parseInt(e.orderDetail.is_logistics,10)),i=parseInt(e.currentShippingType.value,10),r=parseInt(e.currentShippingType.value,10),o=parseInt(e.pointConfig.is_open),a=parseInt(e.invoiceItem.type,10),u=e.__map(e.orderDetail.coupons,(function(t,n){var i=e._f("time")(t.start_time),r=e._f("time")(t.end_time),o=parseInt(t.couponType.type,10),a=parseInt(t.range_type,10),u=parseInt(t.term_of_validity_type,10);return{$orig:e.__get_orig(t),f0:i,f1:r,m5:o,m6:a,m7:u}}));e.$mp.data=Object.assign({},{$root:{m0:n,m1:i,m2:r,m3:o,m4:a,l0:u}})},o=[];n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}))},b151:function(e,t,n){"use strict";(function(e){n("1026"),n("921b");i(n("66fd"));var t=i(n("54e4"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},c781:function(e,t,n){}},[["b151","common/runtime","common/vendor"]]]);