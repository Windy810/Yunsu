(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product/product"],{"0a46":function(e,t,n){"use strict";(function(e,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=s(n("4795")),c=n("f01b"),i=n("4529"),o=s(n("9386")),u=n("1c7a");function s(e){return e&&e.__esModule?e:{default:e}}function l(e){return f(e)||d(e)||m(e)||p()}function p(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function f(e){if(Array.isArray(e))return g(e)}function h(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=m(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a,c=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return c=e.done,e},e:function(e){i=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(i)throw a}}}}function m(e,t){if(e){if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t,n,r,a,c,i){try{var o=e[c](i),u=o.value}catch(s){return void n(s)}o.done?t(u):Promise.resolve(u).then(r,a)}function _(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var c=e.apply(t,n);function i(e){v(c,r,a,i,o,"next",e)}function o(e){v(c,r,a,i,o,"throw",e)}i(void 0)}))}}var b=function(){n.e("components/share").then(function(){return resolve(n("0b60"))}.bind(null,n)).catch(n.oe)},y=function(){n.e("components/uni-number-box").then(function(){return resolve(n("ff8c"))}.bind(null,n)).catch(n.oe)},S=function(){n.e("components/empty").then(function(){return resolve(n("e4d2"))}.bind(null,n)).catch(n.oe)},k=function(){n.e("components/rf-rate/rf-rate").then(function(){return resolve(n("04b2"))}.bind(null,n)).catch(n.oe)},w=function(){n.e("components/rf-badge/rf-badge").then(function(){return resolve(n("b1ad"))}.bind(null,n)).catch(n.oe)},x={components:{rfBadge:w,share:b,rfRate:k,uniNumberBox:y,empty:S},filters:{formatRichText:function(e){if(e){var t=e.replace(/<img[^>]*>/gi,(function(e,t){return e=e.replace(/style="[^"]+"/gi,"").replace(/style='[^']+'/gi,""),e=e.replace(/width="[^"]+"/gi,"").replace(/width='[^']+'/gi,""),e=e.replace(/height="[^"]+"/gi,"").replace(/height='[^']+'/gi,""),e}));return t=t.replace(/style="[^"]+"/gi,(function(e,t){return e=e.replace(/width:[^;]+;/gi,"max-width:100%;").replace(/width:[^;]+;/gi,"max-width:100%;"),e})),t=t.replace(/<br[^>]*\/>/gi,""),t=t.replace(/\<img/gi,'<img style="max-width:100%;height:auto;display:inline-block;margin:10rpx auto;"'),t}return"暂无商品详情"},time:function(e){return(0,o.default)(1e3*e).format("YYYY-MM-DD HH:mm")},discountFilter:function(e){return 10*e.toFixed(2)},maxBuyFilter:function(e){return 0===parseInt(e,10)?"不限购":"限购：".concat(e)},pointExchangeTypeFilter:function(e){var t=["","非积分兑换","积分加现金","积分兑换或直接购买","只支持积分兑换"];return t[parseInt(e,10)]},integralGiveTypeFilter:function(e){var t=["固定积分","百分比"];return t[parseInt(e,10)]},givePointFilter:function(e){return 1===parseInt(e.integral_give_type,10)?"".concat(Math.round(parseInt(e.give_point,10)/100*parseInt(e.minSkuPrice,10))," 积分"):parseInt(e.integral_give_type,10)}},data:function(){return{serviceClass:"none",ladderPreferentialClass:"none",attributeValueClass:"none",cartType:null,maskState:0,couponList:[],productDetail:{},styleObject:{},showTypeImage:null,specClass:"none",specSelected:[],favorite:!1,shareList:[],currentStock:null,currentSkuPrice:null,specList:[],specChildList:[],cartCount:1,product_id:null,evaluateList:[],token:null,cartNum:null,loading:!0,errorInfo:""}},onLoad:function(e){var t=this;return _(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.initData(e.id),t.specList.forEach((function(e){var n,r=h(t.specChildList);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.pid===e.id){t.$set(a,"selected",!0),t.specSelected.push(a);break}}}catch(c){r.e(c)}finally{r.f()}})),t.product_id=e.id;case 3:case"end":return n.stop()}}),n)})))()},onShareAppMessage:function(e){},methods:{showService:function(){this.productDetail.tags&&0===this.productDetail.tags.length||(this.serviceClass="show")},showLadderPreferential:function(){0!==this.productDetail.ladderPreferential.length&&(this.ladderPreferentialClass="show")},showAttributeValue:function(){0!==this.productDetail.attributeValue.length&&(this.attributeValueClass="show")},shareToH5:function(){this.$api.msg("请复制连接进行分享")},hideService:function(){var e=this;this.serviceClass="hide",this.ladderPreferentialClass="hide",this.attributeValueClass="hide",setTimeout((function(){e.serviceClass="none",e.ladderPreferentialClass="none",e.attributeValueClass="none"}),200)},getCoupon:function(t){var n=this;return _(a.default.mark((function c(){return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n.token){a.next=4;break}return n.maskState=0,e.showModal({content:"会话已过期，是否跳转登录页面？",success:function(t){t.confirm&&(e.clearStorage(),e.reLaunch({url:"/pages/public/login"}))}}),a.abrupt("return");case 4:return a.next=6,n.$post("".concat(u.couponReceive),{id:t.id}).then((function(){n.$api.msg("领取成功"),n.maskState=0})).catch((function(e){n.maskState=0,r("log",e," at pages\\product\\product.vue:594")}));case 6:case"end":return a.stop()}}),c)})))()},toEvaluateList:function(){e.navigateTo({url:"/pages/evaluation/list?comment_num=".concat(this.productDetail.comment_num,"&evaluateStat=").concat(JSON.stringify(this.productDetail.evaluateStat))})},numberChange:function(e){this.cartCount=e.number},toggleMask:function(e){var t=this;if(this.productDetail.id){var n="show"===e?10:300,r="show"===e?1:0;this.maskState=2,setTimeout((function(){t.maskState=r}),n)}},initData:function(t){var n=this;return _(a.default.mark((function r(){return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n.token=e.getStorageSync("accessToken"),n.cartNum=e.getStorageSync("cartNum"),r.next=4,n.getProductDetail(t);case 4:case"end":return r.stop()}}),r)})))()},getProductDetail:function(e){var t=this;return _(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$get("".concat(c.productDetail),{id:e}).then(function(){var e=_(a.default.mark((function e(n){var r;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!1,t.productDetail=n.data,e.next=4,n.data.evaluate;case 4:t.evaluateList=e.sent,t.favorite=!!t.productDetail.myCollect,t.specList=t.productDetail.base_attribute_format,t.specList.forEach((function(e){t.specChildList=[].concat(l(t.specChildList),l(e.value))})),t.specSelected=[],n.data.base_attribute_format.forEach((function(e){e.value[0].selected=!0,t.specSelected.push(e.value[0])})),r=[],t.specSelected.forEach((function(e){r.push(e.base_spec_value_id)})),t.productDetail.sku.forEach((function(e){if(e.data===r.join("-"))return t.currentStock=e.stock,void(t.currentSkuPrice=e.price)}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.loading=!1,t.errorInfo=e}));case 2:case"end":return n.stop()}}),n)})))()},toggleSpec:function(){var t=this;if(this.productDetail.id)if("show"===this.specClass){if(!this.token)return this.specClass="none",void e.showModal({content:"会话已过期，是否跳转登录页面？",success:function(t){t.confirm&&(e.clearStorage(),e.reLaunch({url:"/pages/public/login"}))}});if(this.specSelected.length<this.productDetail.base_attribute_format.length)return void this.$api.msg("请先选择规格");"cart"===this.cartType?(this.cartType=null,this.handleCartItemCreate()):"buy"===this.cartType&&(this.cartType=null,this.buy()),this.specClass="hide",setTimeout((function(){t.specClass="none"}),250)}else"none"===this.specClass&&(this.specClass="show")},hideSpec:function(){var e=this;this.specClass="hide",setTimeout((function(){e.specClass="none"}),250)},handleCartItemCreate:function(){var t=this;return _(a.default.mark((function n(){var i,o;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=null,1!==t.productDetail.sku.length){n.next=5;break}i=t.productDetail.sku[0].id,n.next=31;break;case 5:if(1!==t.productDetail.base_attribute_format.length){n.next=14;break}if(!(t.specSelected.length<1)){n.next=11;break}return t.$api.msg("请先选择规格"),n.abrupt("return");case 11:o="".concat(t.specSelected[0].base_spec_value_id);case 12:n.next=30;break;case 14:if(2!==t.productDetail.base_attribute_format.length){n.next=23;break}if(!(t.specSelected.length<2)){n.next=20;break}return t.$api.msg("请先选择规格"),n.abrupt("return");case 20:o="".concat(t.specSelected[0].base_spec_value_id,"-").concat(t.specSelected[1].base_spec_value_id);case 21:n.next=30;break;case 23:if(3!==t.productDetail.base_attribute_format.length){n.next=30;break}if(!(t.specSelected.length<3)){n.next=29;break}return t.$api.msg("请先选择规格"),n.abrupt("return");case 29:o="".concat(t.specSelected[0].base_spec_value_id,"-").concat(t.specSelected[1].base_spec_value_id,"-").concat(t.specSelected[2].base_spec_value_id);case 30:t.productDetail&&t.productDetail.sku.forEach((function(e){e.data!==o||(i=e.id)}));case 31:return n.next=33,t.$post("".concat(c.cartItemCreate),{sku_id:i,num:t.cartCount}).then(function(){var n=_(a.default.mark((function n(r){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$get("".concat(c.cartItemCount)).then((function(n){e.setStorageSync("cartNum",n.data),t.cartNum=n.data}));case 2:t.$api.msg("添加成功，在购物车等");case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(e){r("log",e," at pages\\product\\product.vue:777")}));case 33:case"end":return n.stop()}}),n)})))()},selectSpec:function(e,t,n){var r=this,a=this.specChildList;a.forEach((function(e){e.base_spec_id===t&&r.$set(e,"selected",!1)})),3===parseInt(n,10)&&(this.showTypeImage=a[e].data),2===parseInt(n,10)&&(this.styleObject={color:a[e].data}),this.$set(a[e],"selected",!0),this.specSelected=[],a.forEach((function(e){!0===e.selected&&r.specSelected.push(e)}));var c=[];this.specSelected.forEach((function(e){c.push(e.base_spec_value_id)})),this.productDetail.sku.forEach((function(e){if(e.data===c.join("-"))return r.currentStock=e.stock,void(r.currentSkuPrice=e.price)}))},share:function(e){return"button"===e.from&&r("log",e.target," at pages\\product\\product.vue:826"),{title:"自定义分享标题",path:"/pages/test/test?id=123"}},toFavorite:function(){var t=this;return _(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.productDetail.id){n.next=2;break}return n.abrupt("return");case 2:t.token?t.favorite?t.handleCollectDel():t.handleCollectCreate():(t.specClass="none",e.showModal({content:"会话已过期，是否跳转登录页面？",success:function(t){t.confirm&&(e.clearStorage(),e.reLaunch({url:"/pages/public/logintype"}))}}));case 3:case"end":return n.stop()}}),n)})))()},handleCollectCreate:function(){var e=this;return _(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$post("".concat(i.collectCreate),{topic_id:e.product_id,topic_type:"product"}).then((function(t){e.favorite=!e.favorite,e.$api.msg("收藏成功")})).catch((function(e){r("log",e," at pages\\product\\product.vue:872")}));case 2:case"end":return t.stop()}}),t)})))()},handleCollectDel:function(){var e=this;return _(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$del("".concat(i.collectDel,"?id=").concat(e.productDetail.myCollect.id)).then((function(t){e.favorite=!e.favorite,e.$api.msg("取消收藏成功")})).catch((function(e){r("log",e," at pages\\product\\product.vue:886")}));case 2:case"end":return t.stop()}}),t)})))()},buy:function(){var t=this;return _(a.default.mark((function n(){var r,c,i,o;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(1!==t.productDetail.sku.length){n.next=4;break}r=t.productDetail.sku[0].id,n.next=33;break;case 4:if(1!==t.productDetail.base_attribute_format.length){n.next=14;break}if(!(t.specSelected.length<1)){n.next=10;break}return t.$api.msg("请先选择规格"),n.abrupt("return");case 10:c="".concat(t.specSelected[0].base_spec_value_id),"".concat(t.specSelected[0].title);case 12:n.next=32;break;case 14:if(2!==t.productDetail.base_attribute_format.length){n.next=24;break}if(!(t.specSelected.length<2)){n.next=20;break}return t.$api.msg("请先选择规格"),n.abrupt("return");case 20:c="".concat(t.specSelected[0].base_spec_value_id,"-").concat(t.specSelected[1].base_spec_value_id),"".concat(t.specSelected[0].title," ").concat(t.specSelected[1].title);case 22:n.next=32;break;case 24:if(3!==t.productDetail.base_attribute_format.length){n.next=32;break}if(!(t.specSelected.length<3)){n.next=30;break}return t.$api.msg("请先选择规格"),n.abrupt("return");case 30:c="".concat(t.specSelected[0].base_spec_value_id,"-").concat(t.specSelected[1].base_spec_value_id,"-").concat(t.specSelected[2].base_spec_value_id),"".concat(t.specSelected[0].title," ").concat(t.specSelected[1].title," ").concat(t.specSelected[2].title);case 32:t.productDetail&&t.productDetail.sku.forEach((function(e){e.data!==c||(r=e.id)}));case 33:i={},o={},o.sku_id=r,o.num=t.cartCount,2==t.productDetail.point_exchange_type||4==t.productDetail.point_exchange_type?i.type="point_exchange":i.type="buy_now",i.data=JSON.stringify(o),e.navigateTo({url:"/pages/order/createOrder?data=".concat(JSON.stringify(i))});case 40:case"end":return n.stop()}}),n)})))()},addCart:function(e){this.productDetail.id&&(this.specClass="show",this.cartType=e)},stopPrevent:function(){}}};t.default=x}).call(this,n("6e42")["default"],n("0de9")["default"])},"0c05":function(e,t,n){"use strict";var r=n("7f3e"),a=n.n(r);a.a},3914:function(e,t,n){"use strict";(function(e){n("1026"),n("921b");r(n("66fd"));var t=r(n("7cf3"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},"7cf3":function(e,t,n){"use strict";n.r(t);var r=n("818d"),a=n("c7ca");for(var c in a)"default"!==c&&function(e){n.d(t,e,(function(){return a[e]}))}(c);n("0c05");var i,o=n("f0c5"),u=Object(o["a"])(a["default"],r["b"],r["c"],!1,null,"5af6e50e",null,!1,r["a"],i);t["default"]=u.exports},"7f3e":function(e,t,n){},"818d":function(e,t,n){"use strict";var r={"rf-rate":function(){return n.e("components/rf-rate/rf-rate").then(n.bind(null,"04b2"))},"rf-badge":function(){return n.e("components/rf-badge/rf-badge").then(n.bind(null,"b1ad"))},"rf-loading":function(){return n.e("components/rf-loading/rf-loading").then(n.bind(null,"ad54"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,parseFloat(e.productDetail.market_price)),r=parseFloat(e.productDetail.price),a=parseFloat(e.productDetail.market_price),c=parseFloat(e.productDetail.price),i=e._f("discountFilter")((e.currentSkuPrice||e.productDetail.price)/e.productDetail.market_price),o=e._f("maxBuyFilter")(e.productDetail.max_buy),u=e._f("pointExchangeTypeFilter")(e.productDetail.point_exchange_type),s=e._f("integralGiveTypeFilter")(e.productDetail.integral_give_type),l=e._f("givePointFilter")(e.productDetail),p=e.__map(e.productDetail.ladderPreferential,(function(t,n){var r=parseInt(t.type,10),a=parseInt(t.type,10),c=parseInt(t.price,10);return{$orig:e.__get_orig(t),m4:r,m5:a,m6:c}})),d=e._f("time")(e.productDetail.evaluate&&e.productDetail.evaluate[0]&&e.productDetail.evaluate[0].created_at),f=e._f("formatRichText")(e.productDetail.intro),h=e.__map(e.productDetail.ladderPreferential,(function(t,n){var r=parseInt(t.type,10),a=parseInt(t.type,10),c=parseInt(t.price,10);return{$orig:e.__get_orig(t),m7:r,m8:a,m9:c}})),m=e.__map(e.specList,(function(t,n){var r=parseInt(t.show_type),a=parseInt(t.show_type),c=parseInt(t.show_type),i=parseInt(t.show_type);return{$orig:e.__get_orig(t),m10:r,m11:a,m12:c,m13:i}})),g=parseInt(e.currentStock||e.productDetail.stock,10),v=e.__map(e.productDetail.canReceiveCoupon,(function(t,n){var r=parseInt(t.term_of_validity_type,10),a=e._f("time")(t.start_time),c=e._f("time")(t.end_time),i=parseInt(t.range_type,10);return{$orig:e.__get_orig(t),m15:r,f7:a,f8:c,m16:i}}));e.$mp.data=Object.assign({},{$root:{m0:n,m1:r,m2:a,m3:c,f0:i,f1:o,f2:u,f3:s,f4:l,l0:p,f5:d,f6:f,l1:h,l2:m,m14:g,l3:v}})},c=[];n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return r}))},c7ca:function(e,t,n){"use strict";n.r(t);var r=n("0a46"),a=n.n(r);for(var c in r)"default"!==c&&function(e){n.d(t,e,(function(){return r[e]}))}(c);t["default"]=a.a}},[["3914","common/runtime","common/vendor"]]]);