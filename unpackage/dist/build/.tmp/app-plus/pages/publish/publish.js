(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/publish/publish"],{"1b5e":function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=s(n("4795")),a=s(n("0ee1"));function s(t){return t&&t.__esModule?t:{default:t}}function c(t,e,n,i,u,a,s){try{var c=t[a](s),o=c.value}catch(r){return void n(r)}c.done?e(o):Promise.resolve(o).then(i,u)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(i,u){var a=t.apply(e,n);function s(t){c(a,i,u,s,o,"next",t)}function o(t){c(a,i,u,s,o,"throw",t)}s(void 0)}))}}var r=[["camera"],["album"],["camera","album"]],f=[["compressed"],["original"],["compressed","original"]],l={data:function(){return{input_content:"",imageList:[],sourceTypeIndex:2,sourceType:["拍照","相册","拍照或相册"],sizeTypeIndex:2,sizeType:["压缩","原图","压缩或原图"],countIndex:8,count:[1,2,3,4,5,6,7,8,9],startX:0,movedX:0,endX:0}},onUnload:function(){this.imageList=[],this.sourceTypeIndex=2,this.sourceType=["拍照","相册","拍照或相册"],this.sizeTypeIndex=2,this.sizeType=["压缩","原图","压缩或原图"],this.countIndex=8},methods:{publish:function(){var e=this;return o(u.default.mark((function n(){var a,s,c,o,r;return u.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.input_content){n.next=3;break}return t.showModal({content:"内容不能为空",showCancel:!1}),n.abrupt("return");case 3:return t.showLoading({title:"发布中"}),n.next=6,e.getLocation();case 6:for(a=n.sent,s=[],c=0,o=e.imageList.length;c<o;c++)r={name:"image-"+c,uri:e.imageList[c]},s.push(r);t.uploadFile({url:"moment/moments",files:s,filePath:"",name:"",formData:{user_id:"1",text:e.input_content,longitude:a.longitude,latitude:a.latitude},success:function(e){t.hideLoading(),t.showToast({icon:"success",title:"发布成功"}),t.navigateBack({delta:1})},fail:function(e){i("log","e: "+JSON.stringify(e)," at pages\\publish\\publish.vue:121"),t.hideLoading(),t.showToast({icon:"none",title:"发布失败,请检查网络"})}});case 10:case"end":return n.stop()}}),n)})))()},getLocation:function(){return new Promise((function(e,n){t.getLocation({type:"wgs84",success:function(t){e(t)},fail:function(t){n(t)}})}))},close:function(t){this.imageList.splice(t,1)},chooseImage:function(){var e=o(u.default.mark((function e(){var n,s=this;return u.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(9!==this.imageList.length){e.next=7;break}return e.next=3,this.isFullImg();case 3:if(n=e.sent,i("log","是否继续?",n," at pages\\publish\\publish.vue:151"),n){e.next=7;break}return e.abrupt("return");case 7:t.chooseImage({sourceType:r[this.sourceTypeIndex],sizeType:f[this.sizeTypeIndex],count:this.imageList.length+this.count[this.countIndex]>9?9-this.imageList.length:this.count[this.countIndex],success:function(t){var e=function(t){s.imageList=s.imageList.concat(t)};a.default.compress(t.tempFilePaths,e)}});case 8:case"end":return e.stop()}}),e,this)})));function n(){return e.apply(this,arguments)}return n}(),isFullImg:function(){var e=this;return new Promise((function(n){t.showModal({content:"已经有9张图片了,是否清空现有图片？",success:function(t){t.confirm?(e.imageList=[],n(!0)):n(!1)},fail:function(){n(!1)}})}))},previewImage:function(e){var n=e.target.dataset.src;t.previewImage({current:n,urls:this.imageList})},touchStart:function(t){this.startX=t.mp.changedTouches[0].pageX},touchEnd:function(e){this.endX=e.mp.changedTouches[0].pageX,this.endX-this.startX>200&&t.navigateBack()}}};e.default=l}).call(this,n("6e42")["default"],n("0de9")["default"])},3902:function(t,e,n){"use strict";var i=n("557d"),u=n.n(i);u.a},"54ba":function(t,e,n){"use strict";(function(t){n("1026"),n("921b");i(n("66fd"));var e=i(n("c2ca"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])},"557d":function(t,e,n){},"55a3":function(t,e,n){"use strict";var i,u=function(){var t=this,e=t.$createElement;t._self._c},a=[];n.d(e,"b",(function(){return u})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}))},"9fcc":function(t,e,n){"use strict";n.r(e);var i=n("1b5e"),u=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=u.a},c2ca:function(t,e,n){"use strict";n.r(e);var i=n("55a3"),u=n("9fcc");for(var a in u)"default"!==a&&function(t){n.d(e,t,(function(){return u[t]}))}(a);n("3902");var s,c=n("f0c5"),o=Object(c["a"])(u["default"],i["b"],i["c"],!1,null,"64fc961e",null,!1,i["a"],s);e["default"]=o.exports}},[["54ba","common/runtime","common/vendor"]]]);